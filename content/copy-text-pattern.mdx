---
title: Copy Text Pattern
summary: An overview of the copy text pattern.
publishedAt: '2023-05-28'
image: '/images/copy-text-pattern.png'
---

Recently, I realised that visitors had no easy way to copy the URL of my posts. To address this, I implemented a "Copy Link" button that allows users to effortlessly copy the current page's URL to their clipboard. Here's a break down of how this was achieved this:

**Retrieving the Current URL**

Since my site is built with [Next.js](https://nextjs.org/), which pre-renders pages on the server, I had to consider the availability of the `window` object. To handle this, we can use a `useEffect` to store the URL in a `currentUrl` state variable.

By checking if the window object exists, it ensures that the code only runs on the client-side, avoiding any server-side rendering issues.

```tsx
const [currentUrl, setCurrentUrl] = useState('');

useEffect(() => {
  if (typeof window !== 'undefined') {
    setCurrentUrl(window.location.href);
  }
}, []);
```

**Copying the URL to the Clipboard**

To handle the copying process, we can leveraged the [Clipboard API](https://developer.mozilla.org/en-US/docs/Web/API/Clipboard_API), which offers a simple way to interact with the user's clipboard. The copy logic is encapsulated within the `handleCopy` function, utilising the `navigator.clipboard.writeText` method to write the current URL to the clipboard and setting the `copied` variable state to true. In case of any errors, an error message is logged to the console.

```tsx
const handleCopy = async () => {
  try {
    await navigator.clipboard.writeText(currentUrl);
    setCopied(true);
  } catch (error) {
    console.error(error);
  }
};
```

**Fallback Mechanism**

To support browsers that do not have access to the Clipboard API, we can implement a fallback mechanism. We can create a temporary textarea element, populate it with the `window.location.href`, select its contents, and use the `document.execCommand` to perform the copy operation. Finally, we remove the temporary element from the DOM.

```tsx
const handleFallbackCopy = () => {
  const tmpElement = document.createElement('textarea');
  tmpElement.value = window.location.href;
  tmpElement.setAttribute('readonly', '');
  tmpElement.style.opacity = '0';
  document.body.appendChild(tmpElement);
  tmpElement.focus();
  tmpElement.select();

  try {
    document.execCommand('copy');
    setCopied(true);
  } catch (error) {
    console.error(error);
  } finally {
    document.body.removeChild(tmpElement);
  }
};
```

**User Feedback**

To enhance the user experience, we can include a visual indicator of the copy action success. The 'copied' state variable tracks the copy status, and appropriate feedback is displayed to the user. After 2.5 seconds, the 'copied' state is reset to its initial value.

```tsx
const [copied, setCopied] = useState(false);

useEffect(() => {
  const resetCopied = () => {
    setCopied(false);
  };
  const timeout = setTimeout(resetCopied, 2500);
  return () => {
    clearTimeout(timeout);
  };
}, [copied]);
```

A quick check if the API is available. If so, return the relevant function. We can then trigger this function when the button is clicked.

```tsx
const handleCopyUrl = () => {
  if (navigator.clipboard) {
    handleCopy();
  } else {
    handleFallbackCopy();
  }
};

return (
  <Tooltip content="Copy URL">
    <button
      onClick={handleCopyUrl}
      aria-label={copied ? 'Copied URL' : 'Copy URL'}
    >
      {copied ? 'Copied!' : <LinkIcon />}
    </button>
  </Tooltip>
);
```

That's about it. Open for extension, closed for modification. You can find the full code [here](https://github.com/kelvinampofo/kelvinamp.me/blob/main/src/app/_components/CopyLinkButton.tsx).
